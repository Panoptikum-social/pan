<h1>Latest Recommendations</h1>

<%= pagination_links @conn, @recommendations, path: &recommendation_frontend_path/3 %>

<%= for group <- Enum.chunk_every(@recommendations, 3, 3, []) do %>
  <div class="row">
    <%= for recommendation <- group do %>

      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <%= link [icon("user-heroicons-outline"), " ", recommendation.user.name],
                     to: user_frontend_path(@conn, :show, recommendation.user),
                     class: "btn btn-xs btn-danger" %>

            <span class="pull-right">
              <%= icon("calendar-heroicons-outline") %>
              <%= recommendation.inserted_at && Timex.format!(recommendation.inserted_at, "{ISOdate}") %>
            </span>
          </div>

          <div class="panel-body">
            <%= if recommendation.podcast do %>
              <%= link [icon("podcast-lineawesome-solid"), " ", recommendation.podcast.title],
                       to: podcast_frontend_path(@conn, :show, recommendation.podcast),
                       class: "btn btn-default btn-xs",
                       style: "color: #000" %>
            <% end %>

            <%= if recommendation.episode do %>
              <%= link [icon("podcast-lineawesome-solid"), " ", recommendation.episode.podcast.title],
                       to: podcast_frontend_path(@conn, :show, recommendation.episode.podcast),
                       class: "btn btn-default btn-xs truncate",
                       style: "color: #000" %>
              <hr style="margin-top: -15px; visibility:hidden;" />
              <%= link [icon("headphones-lineawesome-solid"), " ", recommendation.episode.title],
                        to: episode_frontend_path(@conn, :show, recommendation.episode),
                        class: "btn btn-primary btn-xs truncate" %>
            <% end %>

            <%= if recommendation.chapter_id do %>
              <%= link [icon("podcast-lineawesome-solid"), " ", recommendation.chapter.episode.podcast.title],
                       to: podcast_frontend_path(@conn, :show, recommendation.chapter.episode.podcast),
                       class: "btn btn-default btn-xs truncate",
                       style: "color: #000" %> &nbsp;
              <hr style="margin-top: -15px; visibility:hidden;" />
              <%= link [icon("headphones-lineawesome-solid"), " ", recommendation.chapter.episode.title],
                        to: episode_frontend_path(@conn, :show, recommendation.chapter.episode),
                        class: "btn btn-primary btn-xs truncate" %><br/>
              <%= icon("indent") %> <%= recommendation.chapter.title %>
            <% end %>

            <hr style="margin-top: -15px; visibility:hidden;" />
            <%= icon("thumbs-o-up") %> <i>„<%= recommendation.comment %>“</i>
          </div>
        </div>
      </div>

    <% end %>
  </div>
<% end %>

<%= pagination_links @conn, @recommendations, path: &recommendation_frontend_path/3 %>
